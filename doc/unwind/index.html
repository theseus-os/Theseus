<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Support for unwinding the call stack and cleaning up stack frames."><meta name="keywords" content="rust, rustlang, rust-lang, unwind"><title>unwind - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../unwind/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class="location">Crate unwind</p><div class="block version"><p>Version 0.1.0</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all unwind's items</p></a><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></div><p class="location"></p><div id="sidebar-vars" data-name="unwind" data-ty="mod" data-relpath="../"></div><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button">?</button>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="">unwind</a><button id="copy-path" onclick="copy_path(this)"><img src="../clipboard.svg" width="19" height="18" alt="Copy item import"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/unwind/lib.rs.html#1-916" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Support for unwinding the call stack and cleaning up stack frames.</p>
<p>Uses DWARF debugging information (<code>.eh_frame</code> and <code>.gcc_except_table</code> sections) from object files.
It can also be used to generate stack traces (backtrace) using only that debug information
without using frame pointer registers.</p>
<p>The general flow of the unwinding procedure is as follows:</p>
<ul>
<li>A panic occurs, which jumps to the panic entry point. </li>
<li>The panic entry point invokes the panic_wrapper, which handles said panic 
by invoking <code>start_unwinding()</code> in this crate with the reason for the panic.</li>
<li><code>start_unwinding()</code> generates an iterator over all stack frames in the call stack
(the knowledge for which comes from parsing the .eh_frame section).</li>
<li><code>start_unwinding()</code> creates an unwinding context, which contains the stack frame iterator, 
the reason for the panic, and a reference to the current task being unwound.
It then skips the first several stack frames, which correspond to the panic and unwind handlers themselves.
Note that we cannot unwind those frames because they contain resources that we are currently using for unwinding purposes.</li>
<li>At any point hereafter, the unwinding context must be manually cleaned up.</li>
<li><code>start_unwinding()</code> calls <code>continue_unwinding()</code>, which contains the bulk of the unwinding logic.</li>
<li><code>continue_unwinding()</code> iterates to the “next” stack frame (the previous frame in the call stack),
and invokes its cleanup routine (landing pad) if it has one. </li>
<li>Once the cleanup routine is complete, it jumps to <code>_Unwind_Resume</code> automatically. 
This cannot be changed and is an artifact of how unwinding routines are generated by the compiler.</li>
<li><code>_Unwind_Resume</code> is defined alongside the panic entry pointer, and is nothing more
than a simple wrapper that invokes <code>continue_unwinding()</code> here. </li>
<li><code>continue_unwinding()</code> continues iterating up the call stack. 
Once it reaches the end of the call stack (or an error occurs),
we invoke a finalizer routine called <code>cleanup_unwinding_context()</code>. </li>
<li>In <code>cleanup_unwinding_context()</code>, the unwinding context pointer is recovered and all unwinding resources are freed.
Finally, the task is marked as killed so it can no longer be scheduled in. </li>
</ul>
<p>The flow of some functions was inspired by gcc’s <code>libunwind</code>
and from <code>gimli/unwind-rs/src/glue.rs</code>.</p>
</div></details><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.StackFrame.html" title="unwind::StackFrame struct">StackFrame</a></td><td class="docblock-short"><p>A single frame in the stack, which contains
unwinding-related information for a single function call’s stack frame.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.StackFrameIter.html" title="unwind::StackFrameIter struct">StackFrameIter</a></td><td class="docblock-short"><p>An iterator over the stack frames on the current task’s call stack,
which works in reverse calling order from the current function
up the call stack to the very first function on the stack,
at which point it will return <code>None</code>. </p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.UnwindingContext.html" title="unwind::UnwindingContext struct">UnwindingContext</a></td><td class="docblock-short"><p>This is the context/state that is used during unwinding and passed around
to the callback functions in the various unwinding stages, such as in <code>_Unwind_Resume()</code>. </p>
</td></tr></table><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<table><tr class="module-item"><td><a class="fn" href="fn.invoke_with_current_registers.html" title="unwind::invoke_with_current_registers fn">invoke_with_current_registers</a></td><td class="docblock-short"><p>This function saves the current CPU register values onto the stack (to preserve them)
and then invokes the given closure with those registers as the argument.</p>
</td></tr></table><h2 id="trait-aliases" class="section-header"><a href="#trait-aliases">Trait aliases</a></h2>
<table><tr class="module-item"><td><a class="traitalias" href="traitalias.FuncWithRegisters.html" title="unwind::FuncWithRegisters traitalias">FuncWithRegisters</a></td><td class="docblock-short"></td></tr></table></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="unwind" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script></body></html>